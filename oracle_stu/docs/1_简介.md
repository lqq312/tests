[TOC]

# Oracle数据库的组成

oracle数据库是永久存储在磁盘上的一系列文件的集合，包括：

* 数据文件
* 临时文件
* 控制文件
* Redo日志文件（联机重做日志文件）
* Undo日志文件

Oracle实例：实例（instance）是一组内存的集合，用来管理数据库文件；

![](../pic/oracle_instance01.gif)

对应官方文档：Concepts --> 11.1 Introduction to Physical Storage Structures

# 调整Linux系统参数

1. 检查硬件环境
    * 内存需求
        - 自动存储管理（AMM，Automatic Memory Management）需要共享内存和文件描述符；
        - 共享内存即/dev/shm（该值可能过df -h查看），该值应该比系统内存小，应该比MEMORY_MAX_TARGET和MEMORY_TARGET大；
        - 在/etc/fstab中设置“tmpfs /dev/shm tmpfs defaults,size=4g 0 0”，然后执行`mount -o remount /dev/shm`即可生效；

2. 检查系统架构
    * 检查系统架构和操作系统版本

    ```
    shell> uname -a
    shell> uname -m
    shell> cat /etc/redaht-release
    ```

3. 创建用户和组

    ```
    shell> groupadd oinstall
    shell> groupadd dba
    shell> useradd -g oinstall -G dba oracle
    shell> passwd oracle
    ```

4. 配置内核参数
    ```
    shell> vim /etc/sysctl.d/97-oracledatabase-sysctl.conf
        fs.aio-max-nr=1048576
        fs.file-max=6815744
        # kernel.shmmax设置为物理内存的90%即可（最好能比MEMORY_TARGET大），可取的最大值为物理内存值 -1byte（12G物理内存，该值应该设置为12*1024*1024*1024 -1）
        kernel.shmmax=7517682892
        # 可以使用的共享内存的总页数，将kernel.shmmax的值除以4
        kernel.shmall=1879420723
        kernel.shmmni=4096
        kernel.sem=250 32000 100 128
        net.ipv4.ip_local_port_range=9000 65500
        net.core.rmem_default=262144
        net.core.rmem_max=4194304
        net.core.wmem_default=262144
        net.core.wmem_max=1048576
    shell> sysctl --system
    shell> sysctl -a | grep shmmax
    shell> sysctl -a | grep shmall
    ```

5. 配置资源限制

    ```
    shell> vim /etc/security/limits.conf
        oracle soft nproc 2047
        oracle hard nproc 16384
        oracle soft nofile 1024
        oracle hard nofile 65536
        oracle soft stack 3145728
        oracle hard stack 3145728
    ```

6. 创建数据目录

    ```
    shell> mkdir -pv /u01/app/oracle/product/12.2.0/dbhome_1
    shell> chown -R oracle.oinstall /u01
    shell> chmod -R 775 /u01
    ```

7. 设置环境变量

    ```
    shell> su - oracle
    shell> vim ~/.bash_profile
export ORACLE_SID=vms3devdb
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=${ORACLE_BASE}/product/12.2.0/dbhome_1
export PATH=${ORACLE_HOME}/bin:${PATH}
    ```

8. 修改/etc/hosts

    ```
    shell> hostname
    shell> vim /etc/hosts
        xxx.xxx.xxx.xxx AAA AAA
    ```

9. 关闭SELinux

    ```
    shell> vim /etc/selinux
        SELINUX=disabled
    shell> setenforce 0
    shell> getenforce
    ```

10. 关闭防火墙

    ```
    shell> systemctl stop firewalld
    shell> systemctl disable firewalld
    ```

11. 关闭透明大页

    ```
    shell> cat /sys/kernel/mm/transparent_hugepage/enabled
        [always]表示启用
        [never]表示禁用
    shell> vim /etc/default/grub
        GRUB_CMDLINE_LINUX="crashkernel=auto rhgb quiet transparent_hugepage=never"
    shell> grub2-mkconfig -o /boot/grub2/grub.cfg
    shell> systemctl reboot
    shell> cat /proc/cmdline
    ```

12. 解决依赖关系

    ```
    shell> yum -y install binutils compat-libcap1-1.10 libgcc libstdc++  libstdc++-devel sysstat  gcc-c++ ksh make glibc glibc-devel libaio libaio-devel smartmontools net-tools
    ```

13. 调整swap分区

    oracle建议当RAM为1~2GB时，swap大小应该为RAM的1.5倍，当RAM为2~16GB时，swap应该与RAM大小相等，当RAM大于16GB时，swap应该为16G；

    ```
    shell> mkdir /opt/swap_files
    shell> dd if=/dev/zero of=/opt/swap_files/swap_file01 bs=1GB count=5
    shell> chmod 600 /opt/swap_files/swap_file01
    shell> mkswap /opt/swap_files/swap_file01
    shell> echo "/opt/swap_files/swap_file01 swap swap defaults 0 0" >> /etc/fstab
    shell> swapon -a
    ```








