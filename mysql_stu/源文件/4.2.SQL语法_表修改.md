[TOC]

# 表修改语法
## ALTER主体语法

```
ALTER TABLE tbl_name [alter_specification [, alter_specification] ...] [partition_options]
```

### alter_specification

```
alter_specification:
    table_options
  | ADD [COLUMN] col_name column_definition
        [FIRST | AFTER col_name]
  | ADD [COLUMN] (col_name column_definition,...)
  | ADD {INDEX|KEY} [index_name]
        [index_type] (key_part,...) [index_option] ...
  | ADD {FULLTEXT|SPATIAL} [INDEX|KEY] [index_name]
        (key_part,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]] PRIMARY KEY
        [index_type] (key_part,...)
        [index_option] ...
  | ADD [CONSTRAINT [symbol]] UNIQUE [INDEX|KEY]
        [index_name] [index_type] (key_part,...)
        [index_option] ...
  | ADD [CONSTRAINT [symbol]] FOREIGN KEY
        [index_name] (col_name,...)
        reference_definition
  | ADD CHECK (expr)
  | ALGORITHM [=] {DEFAULT|INPLACE|COPY}
  | ALTER [COLUMN] col_name {SET DEFAULT literal | DROP DEFAULT}
  | CHANGE [COLUMN] old_col_name new_col_name column_definition
        [FIRST|AFTER col_name]
  | [DEFAULT] CHARACTER SET [=] charset_name [COLLATE [=] collation_name]
  | CONVERT TO CHARACTER SET charset_name [COLLATE collation_name]
  | {DISABLE|ENABLE} KEYS
  | {DISCARD|IMPORT} TABLESPACE
  | DROP [COLUMN] col_name
  | DROP {INDEX|KEY} index_name
  | DROP PRIMARY KEY
  | DROP FOREIGN KEY fk_symbol
  | FORCE
  | LOCK [=] {DEFAULT|NONE|SHARED|EXCLUSIVE}
  | MODIFY [COLUMN] col_name column_definition
        [FIRST | AFTER col_name]
  | ORDER BY col_name [, col_name] ...
  | RENAME {INDEX|KEY} old_index_name TO new_index_name
  | RENAME [TO|AS] new_tbl_name
  | {WITHOUT|WITH} VALIDATION
```

#### table_options

```
table_option [[,] table_option] ...

table_option:
    AUTO_INCREMENT [=] value
  | AVG_ROW_LENGTH [=] value
  | [DEFAULT] CHARACTER SET [=] charset_name
  | CHECKSUM [=] {0 | 1}
  | [DEFAULT] COLLATE [=] collation_name
  | COMMENT [=] 'string'
  | COMPRESSION [=] {'ZLIB'|'LZ4'|'NONE'}
  | CONNECTION [=] 'connect_string'
  | {DATA|INDEX} DIRECTORY [=] 'absolute path to directory'
  | DELAY_KEY_WRITE [=] {0 | 1}
  | ENCRYPTION [=] {'Y' | 'N'}
  | ENGINE [=] engine_name
  | INSERT_METHOD [=] { NO | FIRST | LAST }
  | KEY_BLOCK_SIZE [=] value
  | MAX_ROWS [=] value
  | MIN_ROWS [=] value
  | PACK_KEYS [=] {0 | 1 | DEFAULT}
  | PASSWORD [=] 'string'
  | ROW_FORMAT [=] {DEFAULT|DYNAMIC|FIXED|COMPRESSED|REDUNDANT|COMPACT}
  | STATS_AUTO_RECALC [=] {DEFAULT|0|1}
  | STATS_PERSISTENT [=] {DEFAULT|0|1}
  | STATS_SAMPLE_PAGES [=] value
  | TABLESPACE tablespace_name [STORAGE {DISK|MEMORY}]
  | UNION [=] (tbl_name[,tbl_name]...)
```

#### column_definition

```
语法1：
data_type [NOT NULL | NULL] [DEFAULT default_value] [AUTO_INCREMENT] [UNIQUE [KEY]] [[PRIMARY] KEY] [COMMENT 'string'] [COLLATE collation_name] [COLUMN_FORMAT {FIXED|DYNAMIC|DEFAULT}] [STORAGE {DISK|MEMORY|DEFAULT}] [reference_definition]

语法2：
data_type [GENERATED ALWAYS] AS (expression) [VIRTUAL | STORED] [NOT NULL | NULL] [UNIQUE [KEY]] [[PRIMARY] KEY] [COMMENT 'string']
```

#### index_type

```
USING {BTREE | HASH}
```

#### index_option

```
KEY_BLOCK_SIZE [=] value | index_type | WITH PARSER parser_name | COMMENT 'string'
```

#### key_part

```
col_name [(length)] [ASC | DESC]
```

### partition_options

```
partition_option [partition_option] ...

partition_option:
    ADD PARTITION (partition_definition)
  | DROP PARTITION partition_names
  | DISCARD PARTITION {partition_names | ALL} TABLESPACE
  | IMPORT PARTITION {partition_names | ALL} TABLESPACE
  | TRUNCATE PARTITION {partition_names | ALL}
  | COALESCE PARTITION number
  | REORGANIZE PARTITION partition_names INTO (partition_definitions)
  | EXCHANGE PARTITION partition_name WITH TABLE tbl_name [{WITH|WITHOUT} VALIDATION]
  | ANALYZE PARTITION {partition_names | ALL}
  | CHECK PARTITION {partition_names | ALL}
  | OPTIMIZE PARTITION {partition_names | ALL}
  | REBUILD PARTITION {partition_names | ALL}
  | REPAIR PARTITION {partition_names | ALL}
  | REMOVE PARTITIONING
  | UPGRADE PARTITIONING
```

#### partition_definition

```
PARTITION partition_name
    [VALUES
        {LESS THAN {(expr | value_list) | MAXVALUE}
        |
        IN (value_list)}]
    [[STORAGE] ENGINE [=] engine_name]
    [COMMENT [=] 'string' ]
    [DATA DIRECTORY [=] 'data_dir']
    [INDEX DIRECTORY [=] 'index_dir']
    [MAX_ROWS [=] max_number_of_rows]
    [MIN_ROWS [=] min_number_of_rows]
    [TABLESPACE [=] tablespace_name]
    [(subpartition_definition [, subpartition_definition] ...)]
```

#### subpartition_definition

```
SUBPARTITION logical_name
    [[STORAGE] ENGINE [=] engine_name]
    [COMMENT [=] 'string' ]
    [DATA DIRECTORY [=] 'data_dir']
    [INDEX DIRECTORY [=] 'index_dir']
    [MAX_ROWS [=] max_number_of_rows]
    [MIN_ROWS [=] min_number_of_rows]
    [TABLESPACE [=] tablespace_name]
```

## 插入新字段

### 插入单个字段
```
ALTER TABLE tbl_name ADD [COLUMN] col_name column_definition [FIRST | AFTER col_name]
```

>FIRST：指定插入的字段在第一字段，原表中的第一字段后移。
>
>AFTER col_name：用于定义新的字段在指定字段之后。

### 插入多个字段
```
ALTER TABLE tbl_name ADD [COLUMN] (col_name1 column_definition1[, col_name2 column_definition2, ...])
```

用于插入多字字段，所有字段以用字段对应的定义都应在“()”内，插入多个字段的语法与建表语法中的字段定义类似。

## 删除字段
```
ALTER TABLE tbl_name DROP [COLUMN] col_name
```

仅指定要删除的字段的字段名即可。

## 修改字段
修改字段时可一并修改字段的位置。
### 修改字段名称
```
ALTER TABLE tbl_name CHANGE [COLUMN] old_col_name new_col_name column_definition [FIRST | AFTER col_name]
```

### 仅修改字段位置
```
ALTER TABLE tbl_name CHANGE col_name col_name column_definition {FIRST | AFTER col_name}
```

### 修改字段类型与属性定义
```
ALTER TABLE tbl_name MODIFY col_name new_column_definition [FIRST | AFTER col_name]
```

## 修改约束、键和索引
通过<span style="color:red">“SHOW INDEXES FROM tb_name”</span>可查看指定表的索引，**不同的键需使用其独有的关键字来创建**。
### 添加索引
```
ALTER TALBE tbl_name ADD {INDEX|KEY} [index_name] [index_type] (key_part,...) [index_option] ...
```

示例：

```
mysql> alter table salaries add index idx_salary (salary);
```

### 删除索引
```
ALTER TABLE tbl_name DROP {INDEX|KEY} index_name
```

### 修改索引名称
```
ALTER TABLE tbl_name RENAME {INDEX|KEY} old_index_name TO new_index_name
```

### 添加主键约束
```
ALTER TALBE tbl_name ADD [CONSTRAINT [symbol]] PRIMARY KEY [index_type] (key_part,...) [index_option] ...
```

### 删除主键
```
ALTER TABLE tbl_name DROP PRIMARY KEY
```

### 添加唯一键约束
```
ALTER TALBE tbl_name ADD [CONSTRAINT [symbol]] UNIQUE [INDEX|KEY] [index_name] [index_type] (key_part,...) [index_option] ...
```

### 添加全文索引
```
ALTER TALBE tbl_name ADD FULLTEXT [INDEX|KEY] [index_name] (key_part,...) [index_option] ...
```

### 添加空间索引
```
ALTER TALBE tbl_name ADD SPATIAL [INDEX|KEY] [index_name] (key_part,...) [index_option] ...
```

### 添加外键约束
```
ALTER TALBE tbl_name ADD [CONSTRAINT [symbol]] FOREIGN KEY [index_name] (col_name,...) reference_definition
```

### 删除外键
```
ALTER TABLE tbl_name DROP FOREIGN KEY fk_symbol
```

### 设置/删除字段默认值
```
ALTER TABLE tbl_name ALTER [COLUMN] col_name {SET DEFAULT literal | DROP DEFAULT}
```

### 设置表的字符集/排序规则
```
ALTER TABLE tbl_name [DEFAULT] CHARACTER SET [=] charset_name [COLLATE [=] collation_name]
```

### 转换表格的字符集
```
ALTER TABLE tbl_name CONVERT TO CHARACTER SET charset_name [COLLATE collation_name]
```

### 禁用/启用键
临时禁用或启用所有键

```
ALTER TABLE tbl_name {DISABLE | ENABLE} KEYS
```

### 删除/导入表空间
```
ALTER TABLE tbl_name {DISCARD | IMPORT} TABLESPACE
```

# 在线DDL操作
线上环境不建进行DDL操作，会对应用造成极大影响，就尽量避免，如必需执行可参照如下语法进行在线修改。

## 在线执行索引相关操作

Operation|In Place|Rebuilds Table|Permits Concurrent DML|Only Modifies Metadata
-|-|-|-|-
[Creating or adding a secondary index](###创建或添加二级索引)|Yes|No|Yes|No
[Dropping an index](###删除索引)|Yes|No|Yes|Yes
[Renaming an index](###索引重命名)|Yes|No|Yes|Yes
[Adding a FULLTEXT index](###添加全文索引)|Yes *|No *|No|No
[Adding a SPATIAL index](###添加空间索引)|Yes|No|No|No
[Changing the index type](###修改索引类型)|Yes|No|Yes|Yes

### 创建或添加二级索引

```
CREATE INDEX name ON table (col_list);
ALTER TABLE tbl_name ADD INDEX name (col_list);
```

### 删除索引

```
DROP INDEX name ON table;
ALTER TABLE tbl_name DROP INDEX name;
```

### 索引重命名

```
ALTER TABLE tbl_name RENAME INDEX old_index_name TO new_index_name, ALGORITHM=INPLACE, LOCK=NONE;
```

### 添加全文索引

```
CREATE FULLTEXT INDEX name ON table(column);
```

### 添加空间索引

```
CREATE TABLE geom (g GEOMETRY NOT NULL);
ALTER TABLE geom ADD SPATIAL INDEX(g), ALGORITHM=INPLACE, LOCK=SHARED;
```

### 修改索引类型

```
ALTER TABLE tbl_name DROP INDEX i1, ADD INDEX i1(key_part,...) USING BTREE, ALGORITHM=INPLACE;
```

## 在线执行主键相关操作

Operation|In Place|Rebuilds Table|Permits Concurrent DML|Only Modifies Metadata
-|-|-|-|-
[Adding a primary key](###添加一个主键)|Yes *|Yes *|Yes|No
[Dropping a primary key](###删除一个主键)|No|Yes|No|No
[Dropping a primary key and adding another](###删除主键并添加另一个主键)|Yes|Yes|Yes|No

### 添加一个主键

```
ALTER TABLE tbl_name ADD PRIMARY KEY (column), ALGORITHM=INPLACE, LOCK=NONE;
```

### 删除一个主键

```
 ALTER TABLE tbl_name DROP PRIMARY KEY, ALGORITHM=COPY;
```

### 删除主键并添加另一个主键

```
ALTER TABLE tbl_name DROP PRIMARY KEY, ADD PRIMARY KEY (column), ALGORITHM=INPLACE, LOCK=NONE;
```

## 在线执行字段相关操作

Operation|In Place|Rebuilds Table|Permits Concurrent DML|Only Modifies Metadata
-|-|-|-|-
[Adding a column](###添加字段)|Yes|Yes|Yes *|No
[Dropping a column](###删除字段)|Yes|Yes|Yes|No
[Renaming a column](###字段重命名)|Yes|No| Yes *|Yes
[Reordering columns](###对列进行重新排序)|Yes|Yes|Yes|No
[Setting a column default value](###设置字段的默认值)|Yes|No|Yes|Yes
[Changing the column data type](###修改字段的数据类型)|No|Yes|No|No
[Extending VARCHAR column size](###扩展“VARCHAR”字段的大小)|Yes|No|Yes|Yes
[Dropping the column default value](###删除字段默认值)|Yes|No|Yes|Yes
[Changing the auto_increment value](###修改“AUTO_INCREMENT”的值)|Yes|No|Yes|No *
[Making a column NULL](###使字段为“NULL”)|Yes|Yes *|Yes|No
[Making a column NOT NULL](###使字段为“NOT NULL”)|Yes *|Yes *|Yes|No
[Modifying the definition of an ENUM or SET column](###修改“ENUM”和“SET”字段的定义)|Yes|No|Yes|Yes

### 添加字段

```
ALTER TABLE tbl_name ADD COLUMN column_name column_definition, ALGORITHM=INPLACE, LOCK=NONE;
```

### 删除字段

```
ALTER TABLE tbl_name DROP COLUMN column_name, ALGORITHM=INPLACE, LOCK=NONE;
```

### 字段重命名

```
ALTER TABLE tbl CHANGE old_col_name new_col_name data_type, ALGORITHM=INPLACE, LOCK=NONE;
```

### 对列进行重新排序

```
ALTER TABLE tbl_name MODIFY COLUMN col_name column_definition FIRST, ALGORITHM=INPLACE, LOCK=NONE;
```

### 修改字段的数据类型

```
ALTER TABLE tbl_name CHANGE c1 c1 BIGINT, ALGORITHM=COPY;
```

### 扩展“VARCHAR”字段的大小

```
ALTER TABLE tbl_name CHANGE COLUMN c1 c1 VARCHAR(255), ALGORITHM=INPLACE, LOCK=NONE;
```

### 设置字段的默认值

```
ALTER TABLE tbl_name ALTER COLUMN col SET DEFAULT literal, ALGORITHM=INPLACE, LOCK=NONE;
```

### 删除字段默认值

```
ALTER TABLE tbl ALTER COLUMN col DROP DEFAULT, ALGORITHM=INPLACE, LOCK=NONE;
```

### 修改“AUTO_INCREMENT”的值

```
ALTER TABLE table AUTO_INCREMENT=next_value, ALGORITHM=INPLACE, LOCK=NONE;
```

### 使字段为“NULL”

```
ALTER TABLE tbl_name MODIFY COLUMN column_name data_type NULL, ALGORITHM=INPLACE, LOCK=NONE;
```

### 使字段为“NOT NULL”

```
ALTER TABLE tbl_name MODIFY COLUMN column_name data_type NOT NULL, ALGORITHM=INPLACE, LOCK=NONE;
```

### 修改“ENUM”和“SET”字段的定义

```
 CREATE TABLE t1 (c1 ENUM('a', 'b', 'c')); ALTER TABLE t1 MODIFY COLUMN c1 ENUM('a', 'b', 'c', 'd'), ALGORITHM=INPLACE, LOCK=NONE;
```

## 在线对“Generated”字段进行操作

Operation|In Place|Rebuilds Table|Permits Concurrent DML|Only Modifies Metadata
-|-|-|-|-
[Adding a STORED column](###添加“STORED”类型字段)|No|Yes|No|No
[Modifying STORED column order](###修改“STORED”字段顺序)|No|Yes|No|No
[Dropping a STORED column](###删除“STORED”字段)|Yes|Yes|Yes|No
[Adding a VIRTUAL column](###添加“VIRTUAL”类型字段)|Yes|No|Yes|Yes
[Modifying VIRTUAL column order](###修改“VIRTUAL”字段排序)|No|Yes|No|No
[Dropping a VIRTUAL column](###删除“VIRTUAL”字段)|Yes|No|Yes|Yes

### 添加“STORED”类型字段

```
ALTER TABLE t1 ADD COLUMN (c2 INT GENERATED ALWAYS AS (c1 + 1) STORED), ALGORITHM=COPY;
```

### 修改“STORED”字段顺序

```
ALTER TABLE t1 MODIFY COLUMN c2 INT GENERATED ALWAYS AS (c1 + 1) STORED FIRST, ALGORITHM=COPY
```

### 删除“STORED”字段

```
ALTER TABLE t1 DROP COLUMN c2, ALGORITHM=INPLACE, LOCK=NONE;
```

### 添加“VIRTUAL”类型字段

```
ALTER TABLE t1 ADD COLUMN (c2 INT GENERATED ALWAYS AS (c1 + 1) VIRTUAL), ALGORITHM=INPLACE, LOCK=NONE;
```

### 修改“VIRTUAL”字段排序

```
ALTER TABLE t1 MODIFY COLUMN c2 INT GENERATED ALWAYS AS (c1 + 1) VIRTUAL FIRST, ALGORITHM=COPY;
```

### 删除“VIRTUAL”字段

```
ALTER TABLE t1 DROP COLUMN c2, ALGORITHM=INPLACE, LOCK=NONE;
```

## 在线执行键相关操作

Operation|In Place|Rebuilds Table|Permits Concurrent DML|Only Modifies Metadata
-|-|-|-|-
[Adding a foreign key constraint]()|Yes *|No|Yes|Yes
[Dropping a foreign key constraint]()|Yes|No|Yes|Yes

### 添加外键约束

```
ALTER TABLE tbl1 ADD CONSTRAINT fk_name FOREIGN KEY index (col1)   REFERENCES tbl2(col2) referential_actions;
```

### 删除外键

```
ALTER TABLE tbl DROP FOREIGN KEY fk_name;
```

## 表选项相关操作

Operation|In Place|Rebuilds Table|Permits Concurrent DML|Only Modifies Metadata
-|-|-|-|-
[Changing the ROW_FORMAT](###修改“ROW_FORMAT”)|Yes|Yes|Yes|No
[Changing the KEY_BLOCK_SIZE](###修改“KEY_BLOCK_SIZE”)|Yes|Yes|Yes|No
[Setting persistent table statistics](###设置持久的表统计选项)|Yes|No|Yes|Yes
[Specifying a character set](###指定字符集)|Yes|Yes *|No|No
[Converting a character set](###转换字符集)|No|Yes *|No|No
[Optimizing a table](###优化表格)|Yes*|Yes|Yes|No
[Rebuilding with the FORCE option](###使用“FORCE”选项重建表格)|Yes*|Yes|Yes|No
[Performing a null rebuild](###执行“NULL”重建)|Yes*|Yes|Yes|No
[Renaming a table](###表格重命名)|Yes|No|Yes|Yes

### 修改“ROW_FORMAT”

```
ALTER TABLE tbl_name ROW_FORMAT = row_format, ALGORITHM=INPLACE, LOCK=NONE;
```

### 修改“KEY_BLOCK_SIZE”

```
ALTER TABLE tbl_name KEY_BLOCK_SIZE = value, ALGORITHM=INPLACE, LOCK=NONE;
```

### 设置持久的表统计选项

```
ALTER TABLE tbl_name STATS_PERSISTENT=0, STATS_SAMPLE_PAGES=20, STATS_AUTO_RECALC=1, ALGORITHM=INPLACE, LOCK=NONE;
```

### 指定字符集

```
ALTER TABLE tbl_name CHARACTER SET = charset_name, ALGORITHM=INPLACE, LOCK=NONE;
```

### 转换字符集

```
ALTER TABLE tbl_name CONVERT TO CHARACTER SET charset_name, ALGORITHM=COPY;
```

### 优化表格

```
 OPTIMIZE TABLE tbl_name;
```

### 使用“FORCE”选项重建表格

```
ALTER TABLE tbl_name FORCE, ALGORITHM=INPLACE, LOCK=NONE;
```

### 执行“NULL”重建

```
ALTER TABLE tbl_name ENGINE=InnoDB, ALGORITHM=INPLACE, LOCK=NONE;
```

### 表格重命名

```
ALTER TABLE old_tbl_name RENAME TO new_tbl_name, ALGORITHM=INPLACE, LOCK=NONE;
```

## 表空间操作

Operation|In Place|Rebuilds Table|Permits Concurrent DML|Only Modifies Metadata
-|-|-|-|-
[Enabling or disabling file-per-table tablespace encryption](###启用/禁用每个表空间的加密功能)|No|Yes|No|No

### 启用/禁用每个表空间的加密功能

```
ALTER TABLE tbl_name ENCRYPTION='Y', ALGORITHM=COPY;
```

## 在线执行表分区相关操作

Partitioning|In Place|Permits DML|Notes
-|-|-|-
PARTITION BY|No|No |Permits ALGORITHM=COPY, LOCK={DEFAULT|SHARED| EXCLUSIVE}
ADD PARTITION|No|No|Only permits ALGORITHM=DEFAULT, LOCK=DEFAULT. Does not copy existing data for tables partitioned by RANGE or LIST. Concurrent queries are permitted for tables partitioned by HASH or LIST. MySQL copies the data while holding a shared lock.
DROP PARTITION|No|No|Only permits ALGORITHM=DEFAULT, LOCK=DEFAULT. Does not copy existing data for tables partitioned by RANGE or LIST.
DISCARD PARTITION|No|No|Only permits ALGORITHM=DEFAULT, LOCK=DEFAULT
IMPORT PARTITION|No|No|Only permits ALGORITHM=DEFAULT, LOCK=DEFAULT
TRUNCATE PARTITION|Yes|Yes|Does not copy existing data. It merely deletes rows; it does not alter the definition of the table itself, or of any of its partitions.
COALESCE PARTITION|No|No|Only permits ALGORITHM=DEFAULT, LOCK=DEFAULT. Concurrent queries are permitted for tables partitioned by HASH or LIST, as MySQL copies the data while holding a shared lock.
REORGANIZE PARTITION|No|No|Only permits ALGORITHM=DEFAULT, LOCK=DEFAULT. Concurrent queries are permitted for tables partitioned by LINEAR HASH or LIST. MySQL copies data from affected partitions while holding a shared metadata lock.
EXCHANGE PARTITION|Yes|Yes|
ANALYZE PARTITION|Yes|Yes|
CHECK PARTITION|Yes|Yes|
OPTIMIZE PARTITION|No|No|ALGORITHM and LOCK clauses are ignored. Rebuilds the entiretable. See Section 22.3.4, “Maintenance of Partitions”.
REBUILD PARTITION|No|No|Only permits ALGORITHM=DEFAULT, LOCK=DEFAULT. Concurrent queries are permitted for tables partitioned by LINEAR HASH or LIST. MySQL copies data from affected partitions while holding a shared metadata lock.
REPAIR PARTITION|Yes|Yes|
REMOVE PARTITIONING|No|No|Permits ALGORITHM=COPY, LOCK={DEFAULT|SHARED| EXCLUSIVE}