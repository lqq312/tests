[TOC]

# 概述

1. 表是关系型数据库的核心。
2. 表=关系
3. 表是记录的集合，而集合中的数据是无序的。
4. 二维表格模型易于人类理解。
5. MySQL默认存储引擎是基于行（记录）存储，而列存储数据库的压缩效率比较高，适用于分析型的统计。
6. 每行列都是基于列进行组织的。

## 语法详解

```
语法1：
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name (create_definition,...) [table_options] [partition_options]

语法2：
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name (create_definition,...) [table_options] [partition_options] [IGNORE | REPLACE] [AS] query_expression

语法3：
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name { LIKE old_tbl_name | (LIKE old_tbl_name) }
```

1. TEMPORARY：如指定“temporary”则表示创建的是一个临时表，“temporary”临时表是用户的临时表即仅对当前会话生效（其他会话无法查看），可用于在存储过程中存储临时数据，该表的表结构存储在变量“tmpdir”所定义的目录下，其数据是存放在“ibtmp*”的临时表空间中（临时表空间的路径由“innodb_temp_data_file_path”变量指定）。

> * “temporary”临时表所使用的存储引擎在建表的时候如未指定则由“default_tmp_storage_engine”变量指定。
> * 创建临时表所指定的表名不要与当前库中的其他已存在的表的表名重复，或在建表时加上“IF NOT EXISTS”。
> * 在mysql 5.5和mysql 5.6中“TEMPORARY”临时表的表结构定义文件和数据文件均存放在“tmpdir”变量所指定的目录下。
> * 临时表的相关信息保存在“information_schema.innodb_temp_table_info”表中。

2. IF NOT EXISTS：创建表进如该表名已存在则不会创建新的表。

### create_definition

创建时的定义，主要用于指定列的定义、索引等。

```
语法1：
col_name column_definition [CONSTRAINT [symbol]] PRIMARY KEY [index_type] (key_part,...) [index_option] ...

语法2：
col_name column_definition {INDEX|KEY} [index_name] [index_type] (key_part,...) [index_option] ...

语法3：
col_name column_definition [CONSTRAINT [symbol]] UNIQUE [INDEX|KEY] [index_name] [index_type] (key_part,...) [index_option] ...

语法4：
col_name column_definition {FULLTEXT|SPATIAL} [INDEX|KEY] [index_name] (key_part,...) [index_option] ...

语法5：
col_name column_definition [CONSTRAINT [symbol]] FOREIGN KEY [index_name] (col_name,...) reference_definition

语法6：
col_name column_definition CHECK (expr)
```

CONSTRAINT：用于指定引用键的名字。

### column_definition

指定字段的选项（如：自增长的起始值、主键、唯一键等）。

```
语法1：
data_type [NOT NULL | NULL] [DEFAULT default_value] [AUTO_INCREMENT] [UNIQUE [KEY]] [[PRIMARY] KEY] [COMMENT 'string'] [COLLATE collation_name] [COLUMN_FORMAT {FIXED|DYNAMIC|DEFAULT}] [STORAGE {DISK|MEMORY|DEFAULT}] [reference_definition]

语法2：
data_type [GENERATED ALWAYS] AS (expression) [VIRTUAL | STORED] [NOT NULL | NULL] [UNIQUE [KEY]] [[PRIMARY] KEY] [COMMENT 'string']
```

* NOT NULL | NULL：指定该列是否允许空值。
* DEFAULT：为该列指定一个默认值，当插入的记录在该字段为空时则会在这个字段插入这个默认值。
* AUTO_INCREMENT：指定该列为自增长的列。
* UNIQUE [KEY]：定义该字段是否为唯一键。
* [PRIMARY] KEY：定义该字段是否为主键。
* COMMENT 'string'：为该字段指定注释。
* COLUMN_FORMAT {FIXED|DYNAMIC|DEFAULT}：定义字段的格式。
* STORAGE {DISK|MEMORY|DEFAULT}：指定存储方法。
* [GENERATED ALWAYS] AS：定义该列的数值来自于“expression”表达式的计算得来（见示例1）。
* VIRTUAL | STORED：指定创建的列是“VIRTUAL”还是“STORED”，如不指定为“VIRTUAL”或“STORED”则默认创建为“VIRTUAL”列；“VIRTUAL”表示该列的值是在查询时通过CPU计算得来，并且无法在“VIRTUAL”列上创建全文索引；“STORED”表示该列的数据会保存在磁盘上，可对“STORED”类型的列创建全文索引。

```
使用[GENERATED ALWAYS] AS创建一个表：

mysql> CREATE TABLE t10 (
    -> id INT NOT NULL PRIMARY KEY,
    -> num INT generated always AS ( id * 2 ) NOT NULL 
    -> );
mysql> show create table t10\G
*************************** 1. row ***************************
       Table: t10
Create Table: CREATE TABLE `t10` (
  `id` int(11) NOT NULL,
  `num` int(11) GENERATED ALWAYS AS ((`id` * 2)) VIRTUAL NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
mysql> INSERT INTO t10 ( id )
    -> VALUES
    -> ( 1 ),
    -> ( 2 ),
    -> ( 3 );
mysql> select * from t10;
+----+-----+
| id | num |
+----+-----+
|  1 |   2 |
|  2 |   4 |
|  3 |   6 |
+----+-----+
```



### data_type

see http://dev.mysql.com/doc/refman/5.7/en/data-types.html

### key_part

```
col_name [(length)] [ASC | DESC]
```

### index_type

```
USING {BTREE | HASH}
```

### index_option

```
KEY_BLOCK_SIZE [=] value | index_type | WITH PARSER parser_name | COMMENT 'string'
```

### reference_definition

```
REFERENCES tbl_name (key_part,...) [MATCH FULL | MATCH PARTIAL | MATCH SIMPLE] [ON DELETE reference_option] [ON UPDATE reference_option]
```

### reference_option

```
RESTRICT | CASCADE | SET NULL | NO ACTION | SET DEFAULT
```

* RESTRICT = NO ACTION：严格模式，被外键引用时，父表中的值如被子表所引用，则父表中的对应字段不允许更新（见示例2）。
* CASCADE：表示为级联更新模式。
* SET NULL：如父表中被引用的字段或更新则会将其设置为“NULL”。
* SET DEFAULT：如父表中被引用的字段或更新则会将其设置为建表时为字段定的默认值。

```
mysql> CREATE TABLE parent ( id INT NOT NULL auto_increment PRIMARY KEY );
mysql> CREATE TABLE child (
    -> child_id INT NOT NULL,
    -> parent_id INT DEFAULT NULL,
    -> KEY par_id ( parent_id ),
    -> FOREIGN KEY ( parent_id ) REFERENCES parent ( id ) ON DELETE NO action ON UPDATE NO action);

mysql> show create table parent\G
*************************** 1. row ***************************
       Table: parent
Create Table: CREATE TABLE `parent` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
mysql> show create table child\G
*************************** 1. row ***************************
       Table: child
Create Table: CREATE TABLE `child` (
  `child_id` int(11) NOT NULL,
  `parent_id` int(11) DEFAULT NULL,
  KEY `par_id` (`parent_id`),
  CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`) REFERENCES `parent` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4

mysql> insert into parent (id) values (null),(null),(null);
mysql> select * from parent;
+----+
| id |
+----+
|  1 |
|  2 |
|  3 |
+----+
mysql> alter table child modify child_id int not null auto_increment primary key;
mysql> insert into child (parent_id) value (4);
ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails (`test_db`.`child`, CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`) REFERENCES `parent` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
mysql> insert into child (parent_id) value (1);
mysql> select * from child;
+----------+-----------+
| child_id | parent_id |
+----------+-----------+
|        2 |         1 |
+----------+-----------+
mysql> delete from parent where id = 1;
ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (`test_db`.`child`, CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`) REFERENCES `parent` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
mysql> update parent set id = 5 where id = 1;
ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (`test_db`.`child`, CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`) REFERENCES `parent` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
```

> * 一个表的外键可以为空值，若不为空值，则每一个外键的值必须等于另一个表中主键的某个值。
> * 外键是表的一个字段，不是本表的主键，但对应另一个表的主键
> * 定义外键后，不允许删除另一个表中具有关联关系的行。
>   * 主表（父表）：对于两个具有关联关系的表而言，相关联字段中主键所在的表就是主表。
>   * 从表（子表）：对于两个具有关联关系的表而言，相关联字段中外键所在的表就是从表。

定义一个外键时，需要要遵守以下原则：

1. 父表必须已经存在于数据库中，或者是当前正在创建的表。如果是后一种情况，则父表与子表是同一个表，这样的表称为自参照表，这种结构称为自参照完整性。
2. 必须为父表定义主键。
3. 主键不能包含空值，但允许在外键中出现空值。也就是说，只要外键的每个非空值出现在指定的主键中，这个外键的内容就是正确的。
4. 在父表的表名后面指定列名或列名的组合。这个列或列的组合必须是父表的主键或候选键。
5. 外键中列的数目必须和父表的主键中列的数目相同。
6. 外键中列的数据类型必须和父表主键中对应列的数据类型相同。

### table_opeions

```
table_option [[,] table_option] ...

table_option:
    AUTO_INCREMENT [=] value
  | AVG_ROW_LENGTH [=] value
  | [DEFAULT] CHARACTER SET [=] charset_name
  | CHECKSUM [=] {0 | 1}
  | [DEFAULT] COLLATE [=] collation_name
  | COMMENT [=] 'string'
  | COMPRESSION [=] {'ZLIB'|'LZ4'|'NONE'}
  | CONNECTION [=] 'connect_string'
  | {DATA|INDEX} DIRECTORY [=] 'absolute path to directory'
  | DELAY_KEY_WRITE [=] {0 | 1}
  | ENCRYPTION [=] {'Y' | 'N'}
  | ENGINE [=] engine_name
  | INSERT_METHOD [=] { NO | FIRST | LAST }
  | KEY_BLOCK_SIZE [=] value
  | MAX_ROWS [=] value
  | MIN_ROWS [=] value
  | PACK_KEYS [=] {0 | 1 | DEFAULT}
  | PASSWORD [=] 'string'
  | ROW_FORMAT [=] {DEFAULT|DYNAMIC|FIXED|COMPRESSED|REDUNDANT|COMPACT}
  | STATS_AUTO_RECALC [=] {DEFAULT|0|1}
  | STATS_PERSISTENT [=] {DEFAULT|0|1}
  | STATS_SAMPLE_PAGES [=] value
  | TABLESPACE tablespace_name [STORAGE {DISK|MEMORY|DEFAULT}]
  | UNION [=] (tbl_name[,tbl_name]...)
```

* AUTO_INCREMENT [=] value：表的初始AUTO_INCREMENT值。
* AVG_ROW_LENGTH [=] value：表中平均行长度的近似值。
* [DEFAULT] CHARACTER SET [=] charset_name：定义默认字符集。
* CHECKSUM [=] {0 | 1}：定义表变更后，MySQL是否自动更新检验，启用则会导致表更新的速度稍慢，但更容易寻找到受损的表，该选项仅用于MyISAM存储引擎。
* COMMENT [=] 'string'：定义表的注释信息，最长60个字符。
* COMPRESSION [=] {'ZLIB'|'LZ4'|'NONE'}：指定表的压缩格式。
* CONNECTION [=] 'connect_string'：仅用于FEDERATED存储引擎的连接字符串。
* DELAY_KEY_WRITE [=] {0 | 1}：延迟对表中索引的更新，等到表关闭后再更新，仅用于MyISAM。
* MAX_ROWS [=] value：定义表中的行数的最大值，这不是一个硬性指标，仅表示该表必需能存储这么多行。
* MIN_ROWS [=] value：类似于MAX_ROWS，表示预计存储在表中行数的最小值。
* PACK_KEYS [=] {0 | 1 | DEFAULT}：仅用于MyISAM存储引擎。
* ROW_FORMAT [=] {DEFAULT|DYNAMIC|FIXED|COMPRESSED|REDUNDANT|COMPACT}：定义各行如何存储，仅用于MyISAM存储引擎。
* UNION [=] (tbl_name[,tbl_name]...)：把一组相同的表当作一个表使用时，采用UNION，仅用于MERGE存储引擎。
* 

### partition_option

指定分区选项。

```
PARTITION BY
    { [LINEAR] HASH(expr)
    | [LINEAR] KEY [ALGORITHM={1|2}] (column_list)
    | RANGE{(expr) | COLUMNS(column_list)}
    | LIST{(expr) | COLUMNS(column_list)} }
[PARTITIONS num]
[SUBPARTITION BY
    { [LINEAR] HASH(expr)
    | [LINEAR] KEY [ALGORITHM={1|2}] (column_list) }
  [SUBPARTITIONS num]
]
[(partition_definition [, partition_definition] ...)]
```

### partition_definition

```
PARTITION partition_name
    [VALUES
        {LESS THAN {(expr | value_list) | MAXVALUE}
        |
        IN (value_list)}]
    [[STORAGE] ENGINE [=] engine_name]
    [COMMENT [=] 'string' ]
    [DATA DIRECTORY [=] 'data_dir']
    [INDEX DIRECTORY [=] 'index_dir']
    [MAX_ROWS [=] max_number_of_rows]
    [MIN_ROWS [=] min_number_of_rows]
    [TABLESPACE [=] tablespace_name]
    [(subpartition_definition [, subpartition_definition] ...)]
```

### subpartition_definition

```
SUBPARTITION logical_name
    [[STORAGE] ENGINE [=] engine_name]
    [COMMENT [=] 'string' ]
    [DATA DIRECTORY [=] 'data_dir']
    [INDEX DIRECTORY [=] 'index_dir']
    [MAX_ROWS [=] max_number_of_rows]
    [MIN_ROWS [=] min_number_of_rows]
    [TABLESPACE [=] tablespace_name]
```

### query_expression

```
SELECT ...   (Some valid select or union statement)
```

# 查看表结构

## 语法1

```
SHOW CREATE TABLE tb_name;
```

### 示例

```
mysql> SHOW CREATE TABLE t2\G
*************************** 1. row ***************************
       Table: t2
Create Table: CREATE TABLE `t2` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `data` json NOT NULL,
  `name` varchar(50) GENERATED ALWAYS AS (json_extract(`data`,'$.name')) STORED,
  PRIMARY KEY (`id`),
  KEY `name` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=gbk
```

## 语法2

```
SHOW TABLE STATUS [LIKE] 'tb_name';
```

### 示例

```
mysql> SHOW TABLE STATUS LIKE 't2'\G
*************************** 1. row ***************************
           Name: t2
         Engine: InnoDB
        Version: 10
     Row_format: Dynamic
           Rows: 4
 Avg_row_length: 4096
    Data_length: 16384
Max_data_length: 0
   Index_length: 0
      Data_free: 0
 Auto_increment: 5
    Create_time: 2019-07-31 12:52:56
    Update_time: 2019-07-31 14:52:57
     Check_time: NULL
      Collation: gbk_chinese_ci
       Checksum: NULL
 Create_options: 
        Comment: 
```

## 语法3

```
DESC tb_name;
```

### 示例

```
mysql> DESC t2;
+-------+-------------+------+-----+---------+------------------+
| Field | Type        | Null | Key | Default | Extra            |
+-------+-------------+------+-----+---------+------------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment   |
| data  | json        | NO   |     | NULL    |                  |
| name  | varchar(50) | YES  | MUL | NULL    | STORED GENERATED |
+-------+-------------+------+-----+---------+------------------+
```

## 语法4

除使用以上语法，在information_schema.tables表中也可查看指定表的表结构等信息。

```
mysql> select * from tables where table_name = "t0" and table_schema = "test_db"\G
*************************** 1. row ***************************
  TABLE_CATALOG: def
   TABLE_SCHEMA: test_db
     TABLE_NAME: t0
     TABLE_TYPE: BASE TABLE
         ENGINE: InnoDB
        VERSION: 10
     ROW_FORMAT: Dynamic
     TABLE_ROWS: 5
 AVG_ROW_LENGTH: 1638
    DATA_LENGTH: 8192
MAX_DATA_LENGTH: 0
   INDEX_LENGTH: 0
      DATA_FREE: 0
 AUTO_INCREMENT: 13
    CREATE_TIME: 2020-03-23 15:05:04
    UPDATE_TIME: 2020-03-23 15:08:18
     CHECK_TIME: NULL
TABLE_COLLATION: utf8mb4_general_ci
       CHECKSUM: NULL
 CREATE_OPTIONS: 
  TABLE_COMMENT: 
```

