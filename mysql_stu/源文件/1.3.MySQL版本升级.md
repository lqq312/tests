[TOC]

# MySQL版本升级常用方法

1. mysqldump：mysql官方数据库逻辑备份工具。
2. mysqlpump：是mysqldump的衍生工具，其特点的并行备份、直接生成压缩文件、备份进度指示和加载备份文件可心先建表后建索引。
3. xtrabackup：使用Percona公司的“Xtrabackup”工具完成数据备份后再导入至新版本的库中。
4. mysql_upgrade：mysql官方升级MySQL版本时执行该命令用于查找升级的MySQL服务器的不兼容的问题。

## 使用mysql_upgrade升级

MySQL 5.6升级至MySQL 5.7
	1. 安全关闭MySQL5.6
	
	```
	shell> systemctl stop mysqld
	```
	
	2. 在新的数据库的配置文件中指定原库的数据目录、日志等目录的路径。

    ```
    shell> vim /etc/my.cnf
        [mysqld]
        ...
        datadir=/database/mysql5.6/data
        pid-file=/database/mysql5.6/run/mysqld.pid
        log_bin=/database/mysql5.6/binlogs/master
        log_error=/database/mysql5.6/logs/mysql.err
        slow_query_log_file=/database/mysql5.6/logs/mysql.slow
        ...
    
        [mysqld_safe]
        socket=/database/mysql5.6/run/mysqld.sock
        log-error=/database/mysql5.6/logs/mysql.err
    ```

    

3. 将原有的软链接重新链接至目标版本的数据库上
  ```
  shell> rm -rf /usr/local/mysql
  shell> ln -sv /usr/local/mysql-5.7.25-el7-x86_64 /usr/local/mysql
  ```

4. 将配置文件进行升级

  ```
  shell> mysql_upgrade -uroot -hlocalhost -p --protocol=tcp -s
  ```

  因此建议使用“-s”选项升级系统库，如不指定则会导致线上的库的所有数据文件的表结构也会被重建。

  注意：mysql5.5与mysql5.6是兼容的，mysql5.6与mysql5.7也是相互兼容的，但在没有执行“mysql_upgrade”之前如启动的新版本的数据库服务则在“log-error”中会有很多的“Warning”。

在mysql5.6升级至mysql5.7前可将系统库“mysql”cp至指定路径，当升级后有故障时可进行回退，在回退时需要将系统库的属主和属组修改为“mysql”。

## 使用mysqlpump升级

## 使用xtrabackup升级

