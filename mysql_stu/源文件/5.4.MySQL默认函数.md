[TOC]

# 在表达式中实现类型转换

当操作符与不同类型的操作数一起使用时，会发生类型转换以使得操作数兼容。

## 隐式转换

当操作符与不同类型的操作数一起使用时，会发生类型转换以使操作数兼容。则会发生转换隐式。

隐式转换的规则：

1. 两个操作数至少有一个是“NULL”时，其比较结果也是“NULL”，当运算符为“<=>”时对两个“NULL”做比较时会返回1，这两种情况都不需要做类型转换。
2. 两个操作数都是字符串，会按照字符串来比较，不做类型转换。
3. 两个操作数都是整数，按照整数来比较，不做类型转换。
4. 十六进制的值和非数字做比较，会被当做二进制字符串进行比较。
5. 有一个参数是“TIMESTAMP”或“DATETIME”，并且另外一个参数是常量，常量会被转换为“TIMESTAMP”。
6. 有一个操作数是“DECIMAL”类型，如果另外一个参数是“DECIMAL”或者整数，会将整数转换为“DECIMAL”后进行比较，如果另外一个参数是浮点数，则会把“DECIMAL”转换为浮点数进行比较。
7. 所有其他情况下，两个参数都会被转换为浮点数再进行比较。
8. 如果字符串是以非数字开头，会被隐式转换成数字0。
9. 如果字符串以数字开头，且整个字符串都是数字则会直接将字符串类型的数字转换成对应的数字。
10. 如果字符串以数字开头，但存在非数字的字符，则会将字符串转换为开头的数字对应的值。

```
mysql> SELECT 1 > "6X";
        +----------+
        | 1 > "6X" |
        +----------+
        |        0 |
        +----------+
mysql> SHOW WARNINGS;
        +---------+------+----------------------------------------+
        | Level   | Code | Message                                |
        +---------+------+----------------------------------------+
        | Warning | 1292 | Truncated incorrect DOUBLE value: '6X' |
        +---------+------+----------------------------------------+
mysql> SELECT 1 = "1A";
        +----------+
        | 1 = "1A" |
        +----------+
        |        1 |
        +----------+
mysql> SELECT 1 = "A1";
        +----------+
        | 1 = "A1" |
        +----------+
        |        0 |
        +----------+
mysql> SELECT "A1" = 0;
        +----------+
        | "A1" = 0 |
        +----------+
        |        1 |
        +----------+
```

## 显式转换

### CAST(expr AS type)

使用CAST()函数执行显式类型转换。

```
mysql> SELECT CAST(1 AS TIME);
        +-----------------+
        | CAST(1 AS TIME) |
        +-----------------+
        | 00:00:01        |
        +-----------------+
```

# 操作符

## 操作符的优先级

运算符的优先级在以下列表中从高到低依次排列，同一行的操作符具有相同的优先级。

1. INTERVAL
2. BINARY, COLLATE
3. !
4. \- (unary minus), ~ (unary bit inversion)
5. ^
6. \*, /, DIV, %, MOD
7. -, +
8. <<, >>
9. &
10. |
11. =(等值比较), <=>, >=, >, <=, <, <>, !=, IS, LIKE, REGEXP, IN
12. BETWEEN ... AND ..., CASE, WHEN, THEN, ELSE
13. NOT
14. AND, &&
15. XOR
16. OR, ||
17. =(赋值操作), :=

如果在表达式中以相同优先级发生运算的运算符，如用于比较操作则从左至右进行，如用于赋值则从右向左进行求值。

某些运算符的优先级和含义取决于SQL模式：

- 在默认情况下“||”是逻辑与操作符，但如果启用“PIPES_AS_CONCAT”后，“||”是字符串连接符，其优先级在“^”与一元操作符之间。
- 在默认情况下“!”的优先级高于“NOT”，但在启用“HIGH_NOT_PRECEDENCE”后，“!”和“NOT”具有相同的优先级。

注意：<span style="color:red">“( )”</span>可提高括号内的操作符的运算优先级。

## 比较函数和操作符

Name | Description
- | -
\[NOT\] BETWEEN ... AND ... | 检查指定字符是否在指定范围内
COALESCE() | 返回第一个非空的参数
= | 等值比较
<=> | 安全的等值比较，任何值与“NULL”比较都不会返回“NULL”
\> | 大于
\>= | 大于或等于
< | 小于
<= | 小于或等于
!=, <> | 不等值比较
GREATEST() | 返回列表中的最大值
LEAST() | 返回列表中的最小值
\[NOT\] IN() | 检查指定值是否存在于列表内
INTERVAL() | 返回小于第一个参数的参数的索引
IS \[NOT\] {TRUE | FALSE} | 针对“bool”值的检查
IS {NULL | NOT NULL} | 检查是否为空
ISNULL() | 检查参数是否为空
\[NOT\] LIKE | 简单的模式匹配，支持使用“%”和“_”
RLIKE 或 REGEXP | 正则表达式匹配
STRCMP() | 比较两个字符串

比较操作符的结果一般为1（TRUE）、0（FALSE）或“NULL”，这些操作适用于数字和字符串。根据需要，字符串会自动转换为数字或将数字转换成字符串。

参照官方文档12.3.2章

## 逻辑操作符

Name | Description
- | -
AND, && | 逻辑与
NOT, ! | 逻辑非
OR, || | 逻辑或
XOR | 逻辑异或

在SQL中，所有逻辑操作符的运算结果只有“TURE”，“FALSE”或“NULL（UNKNOW）”。

在MySQL中，任何非“0”和非“NULL”的值在逻辑操作中都为“TRUE”。

## 赋值操作符

Name | Description
- | -
= | 赋值操作（一般用于“SET”子句，或“UPDATE”语句中的“SET”子句），但不建议使用，可能会与等值比较的操作符混淆
:= | 赋值操作符，建议使用

在赋值操作中，表达式的左侧为变量名，右侧为要赋予的值或能产生结果的表达式。

#流控制函数

Name | Description
- | -
CASE |  Case操作符
IF() | If/else 语句
IFNULL() | NULL If/else 语句
NULLIF() | 当表达式成立则返回“NULL”

### CASE

语法1：

`CASE value WHEN [compare_value] THEN result [WHEN [compare_value] THEN result ...] [ELSE result] END`

“value”与哪一个“compare_value”等值比较的结果为“TRUE”就返回哪个分支下对应的“result”。

语法2：

`CASE WHEN [condition] THEN result [WHEN [condition] THEN result ...] [ELSE result] END`

返回第一个“condition”为“TRUE”的对应“result”，如果没有比较或条件为“TRUE”的结果则返回“ELSE”后的结果，如果没有“ELSE”部分则返回“NULL”。

注意：此处的“CASE”操作符与“CASE”语句不同，“CASE”语句不能有“ELSE NULL”子句，“CASE”语句是以“END CASE”结尾而不是“END”。

```
mysql> SELECT CASE 1 WHEN 1 THEN "one"
    -> WHEN 2 THEN "two"
    -> ELSE "more"
    -> END ;
        +------------------------------------------------------------+
        | CASE 1 WHEN 1 THEN "one" WHEN 2 THEN "two" ELSE "more" END |
        +------------------------------------------------------------+
        | one                                                        |
        +------------------------------------------------------------+
mysql> SELECT
    -> CASE WHEN 1 = TRUE THEN "one"
    -> WHEN 0 != TRUE THEN "zero"
    -> END;
        +--------------------------------------------------------------+
        | CASE WHEN 1 = TRUE THEN "one" WHEN 0 != TRUE THEN "zero" END |
        +--------------------------------------------------------------+
        | one                                                          |
        +--------------------------------------------------------------+
```

### IF()

语法：
`IF(expr1, expr2, expr3)`

如果“expr1”为“TRUE”（“expr1 <> 0”且“expr1 <> NULL”）则“IF()”表达式返回“expr2”，否则就返回“expr3”。

IF()函数的默认返回类型计算如下：

- 如果“expr2”或“expr3”产生了一个字符串，则结果为字符串。
- 如果“expr2”或“expr3”都是字符串，且任一字符串区分大小写，则结果也区分大小写。
- 如果“expr2”或“expr3”产生一个浮点数，则结果为浮点数。
- 如果“expr2”或“expr3”产生一个整数，则结果为整数。

### IFNULL()

语法：
`IFNULL(expr1,expr2)`

如果“expr1”不为“NULL”则“IFNULL()”就返回“expr1”，否则就返回“expr2”。

### NULLIF()

语法：
`NULLIF(expr1, expr2)`

如果“expr1 = expr2”为“TRUE”就返回“NULL”，否则就返回“expr1”，这与“CASE WHEN expr1 = expr2 THEN NULL ELSE expr1 END”产生相同的效果。

# 字符串函数和操作符

任何经字符串函数处理后的结果如果大于“max_allowed_packet”系统变量的值，则字符串函数返回“NULL”。

如果使用长度参数的函数，非整数参数将四舍五入为最接近的整数。

##字符串操作函数

### ASCII()

语法：
`ASCII(str)`

返回字符串“str”最左侧字符的ASCII码编号，如果“str”为空则返回0，如果“str”为“NULL”则返回“NULL”，ASCII()函数适用于8位字符。

```
mysql> SELECT ASCII("A");
        +------------+
        | ASCII("A") |
        +------------+
        |         65 |
        +------------+
mysql> SELECT ASCII("AB");
        +-------------+
        | ASCII("AB") |
        +-------------+
        |          65 |
        +-------------+
mysql> SELECT ASCII(2);
        +----------+
        | ASCII(2) |
        +----------+
        |       50 |
        +----------+
mysql> SELECT ASCII("2");
        +------------+
        | ASCII("2") |
        +------------+
        |         50 |
        +------------+
```

### BIN()

语法：
`BIN(N)`

返回“N”字符串的二进制数，但“N”是“BIGINT”类型，相当于“CONV(N, 10, 2)”。如果“N”为“NULL”则返回“NULL”，（如果“N”是字符串则会执行隐式转换后再转换为二进制）。

### BIT_LENGTH()

语法：
`BIT_LENGTH(str)`

返回字符串的二进制长度。

### CHAR()

语法：
`CHAR(N, ... [USING charset_name])`

将每个“N”转换为一个整数，并按给定的字符集返回对应“N”的顺序的字符组成的字符中。

```
mysql> SELECT CHAR(77,121,83,81,"76");
        +-------------------------+
        | CHAR(77,121,83,81,"76") |
        +-------------------------+
        | MySQL                   |
        +-------------------------+
mysql> SELECT CHAR(77,77.3,"77.6");
        +----------------------+
        | CHAR(77,77.3,"77.6") |
        +----------------------+
        | MMM                  |
        +----------------------+
    1 row in set, 1 warning (0.00 sec)
mysql> SHOW WARNINGS;
        +---------+------+-------------------------------------------+
        | Level   | Code | Message                                   |
        +---------+------+-------------------------------------------+
        | Warning | 1292 | Truncated incorrect INTEGER value: '77.6' |
        +---------+------+-------------------------------------------+
```

## 字符串比较操作符


















