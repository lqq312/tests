[TOC]

# mysql配置参数

1. 通过查看/etc/my.cnf查看当前实例的参数。

2. 登陆数据库后通过“show variables;”来查看当前实例的所有参数。

3. 如需查看包含某些字符串的参数可使用如下命令：

	```
	mysql> show [global|session] variables [like "%innodb%" | where expr];
	```

4. 查看指定变量的值：

	```
	mysql> select @@VARIABLE_NAME;
	```

5. 如果某些变量即是全局变量又是会话级变量，可使用如下方式查看不同级别的参数的值：

	```
	mysql> select @@global.VARIABLE_NAME;
	mysql> select @@session.VARIABLE_NAME;
	```

6. mysql的参数可分为只读参数和非只读参数，用户可在线修改非只读参数而只读参数只能通过修改配置文件交重启才能生效。

# 修改mysql的参数

不是所有的mysql参数都能进行修改的，对支持修改的参数可使用如下命令进行修改：

1. 修改全局参数，仅对此后的新连接有效，对当前已连接的会话不生效。

```
mysql> set global VARIABLE_NAME=VAULE;
```

2. 修改会话级参数，仅对当前会话有效；

```
mysql> set session VARIABLE_NAME=VALUE;
```

**注意：在设置参数的值的时候如没有指定“global”或“session”时默认设置的是“session”，仅对当前会话有效。**

如不指定“session或global”则默认修改“session”级别的配置。

使用命令的方式修改的参数的值重启后会失效，如需永久生效需在配置文件中定义。

# 配置文件详解

MySQL的配置文件：
1. MySQL的配置文件支持使用标签的形式在一个配置文件中保存多个不同版本的实例的配置，如下所示。

	```
	[mysqld571]
	...
	...
	[mysqld572]
	...
	...
	[mysqld561]
	...
	...
	```

	详细示例可参见MySQL多实例的配置。

2. MySQL读取配置文件的顺序

   ```
   shell> mysqld --help -vv | grep my.cnf
   		/etc/my.cnf ==> /etc/mysql/my.cnf ==> /usr/local/mysql/etc/my.cnf ==> ~/.my.cnf
   ```

3. 查看MySQL的默认参数

   ```
   shell> mysqld --verbose --help | less
   ```



在主配置文件中可以使用“include”字段将其他的配置引入至当前的配置文件中。
```
[mysqld]

	federated：无对应值，可定义MySQL实例开启“Federated”存储引擎。

	autocommit：定义是否自动提交，bool值，同为“session”和“global”级别变量。

	default_storage_engine=<innodb|myisam|...>：定义默认存储引擎，应该将其设置为innodb。

	log_error=/path/to/mysql.err：定义错误日志的路径和文件名。

	default_storage_engine：定义默认使用的存储引擎。

	default_tmp_storage_engine：指定临时表所使用的存储引擎。

	tmpdir：用于存储临时文件，包括“tempoary”临时表的表结构文件。

	sql_safe_updates=<ON|OFF>：限定在“UPDATE”时如果没有一并使用“LIMIT”子句或“WHERE”子句时拒绝进行“UPDATE”操作从而保证表中的数据的安全性。

	innodb_data_file_path = ibdata1:12M:autoextend：指定系统表空间的绝对路径和文件名，指定初始的共享表空间的大小，指定共享表空间为自动扩展的。

	innodb_status_output_locks = 1：设置mysql在执行“show engine innodb status”时显示更详细的内容。

	innodb_lock_wait_timeout：指定事务的锁超时时长，单位为秒。

​	############# log setting #############

​	slow_query_log = 1：定义是否开启慢查询日志。

​	slow_query_log_file =  /database/mysql5.7/logs/mysql.slow：定义慢查询日志的“path”和文件名。

​	log_queries_not_using_indexes = 1：定义是否将未使用索引的查询记录到慢查询日志中。

​	log_slow_admin_statements = 1：定义是否将管理类操作是慢查询记录到慢查询日志中，如“ALTER”/“ANALYZE TABLE”/“check table”/“create index”/“drop index”/“optimize table”/“repair table”。

​	log_slow_slave_statements = 1：定义是否记录从库上执行的慢查询语句。

​	log_throttle_queries_not_using_indexes = 10：限制每分钟记录没有使用索引的SQL语句的次数。

​	expire_logs_days = 90：指定日志的过期时间，到期后的日志会自动删除。

​	long_query_time = 2

​	min_examined_row_limit = 100

​	innodb_flush_log_at_trx_commit = [0|1|2]：每隔1秒将缓存中的undo/redo log写入磁盘；1：每次事务提交时写入磁盘；2：写入系统的缓存，但每隔1秒才调用文件系统的flush将缓存刷新到磁盘中。如果允许有1秒的数据丢失则将其设置为2才是最优方案。

	innodb_print_all_deadlocks=1：将死锁信息输出至mysql的错误日志中。

​	############# replication log #############

​	sync_binlog=[0|1|N]：指定将二进制日志写入磁盘的策略，0：依赖系统执行合并写入；1：每次提交事务后都需要写入，方案最安全；N：一般为100～1000，表示写入N条后合并写入磁盘；

	binlog_format = [row|statement]：如隔离级别设置为rc则此处一定要设置为row，否则可能会产生主从数据不一致的情况；

​	############# innodb setting #############

	innodb_log_buffer_size：用于指定内存中存储redo日志的大小，如果innodb_buffer_pool_size较小则建议设置为一样，如果innodb_buffer_pool_size较大则建议设置为一秒内数据量的大小或一个大事务的数据量大小；

	innodb_log_file_size：用于指定redo日志的文件大小，此处为单个文件的大小，一般建议总大小为innodb_buffer_pool_size的大小，如果设置较小可能会导致MySQL被HANG住；

	innodb_log_files_in_group：用于指定设置几个redo日志文件；

	innodb_log_group_home_dir：用于指定redo日志存放的目录，一般建议与数据目录分开存放在不同的物理磁盘上以避免IO资源冲突；

	innodb_flush_log_at_trx_commit={0|1|2}：定义redo日志从内存中的buffer刷新至磁盘的策略，设置为0性能最好但可能会丢失一秒或一半innodb_log_buffer大小的数据，设置为1则每次事务提交时就会将innodb_log_buffer刷新到磁盘，不会导致数据丢失是比较安全的，设置为2会将innodb_log_buffer中的数据写入至系统缓存中；

	innodb_flush_log_at_timeout：默认为1秒，如果修改此处的时间为2秒则innodb_flush_log_at_trx_commit设置为0时则会在每2秒或innodb_log_buffer_size使用一半时自动刷盘，如果容忍的数据丢失时间长则可以将该变量设置为一个较大值以降低磁盘的IO；

​	innodb_buffer_pool_size： 用于存放InnoDB数据页、索引数据、脏页（即缓冲数据，在内存中修改而尚未刷新至磁盘的数据）以用自适应的哈希索引和行锁等（默认为128M即134217728），可以将缓冲池大小设置为服务器物理内存的80%。

​	innodb_buffer_pool_instances：设置将innodb_buffer_pool分为多少个实例，建议有多少颗CPU的核心就设置多少个instances。

​	innodb_old_blocks_pct：设置LRU中old page所占的百分比，而New page和Old page之前的位置即为midpoint所在的空间。

​	innodb_old_blocks_time：设置数据页在old中缓存的最小时长，建议设置为1秒，如果1秒内频繁被读到该页说明很有可能在执行扫表的操作，而扫表实际上并不是针对性的读取热点数据，因此1秒内频繁被读到的页仍应该被保存在LRU的末尾即old page所在的内置。

​	innodb_buffer_pool_dump_pct：用于指定仅把缓冲池中前百分之多少的数据备份出来，可以将其设置得稍大（40）。

​	innodb_temp_data_file_path：定义临时表空间的文件名、大小等属性，该文件默认存储在数据目录（由“datadir”变量定义的）下。

​	innodb_buffer_pool_dump_at_shutdown：在停止数据库服务时将热点数据备份至磁盘。

​	innodb_buffer_pool_load_at_startup：在服务启动时从磁盘加载备份下来的热点数据。

​	innodb_flush_neighbors：0表示不刷附近的脏页，1表示刷附近的脏页，2表示刷附近的脏页，但2的范围比1大，一般建议将其设置为0。

​	innodb_log_file_size：指定redo_log文件的大小，一般建议将其设置为半小时内的写入数据量（参照8.1章中InnoDB每分钟数据写入的算法）。

	innodb_io_capacity：表示一次刷新多少脏页到磁盘，建议设置为max的一半。

	innodb_io_capacity_max：表示一次最多刷新多少脏页到磁盘中，可根据存储的IOPS进行优化。

	innodb_lru_scan_depth：innodb lru list的刷新深度，为了保证LRU中足够的空闲页可用，除了会从Flush List中刷新脏页到磁盘还会从LRU中将数据刷新到磁盘，该值用于设置每个innodb_buffer_pool_instances中一次刷新多少个脏页到磁盘中，一般建议将该值设置为（Innodb_io_capacity_max/nnodb_buffer_pool_instances）。

	innodb_doublewrite：开启innodb的DoubleWrite的功能。

[mysqld_safe]

	syslog：定义将mysql的错误日志存储到系统日志文件中（需要与“syslog_tag”变量一并定义）。

	syslog_tag=stock #mysqld_stock：在系统日志文件中定义与“MySQL”相关的日志的“tag”。

[client]

	user：指定mysql客户端工具使用哪个用户的身份登陆数据库。

	password：指定mysql客户端登陆密码。

	host：指定mysql客户端工具要登陆的主机。
```